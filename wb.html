<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta property="description" content="" />
<link rel="stylesheet" href="asset/semantic.min.css" />
<link rel="stylesheet" href="asset/style.css" />
<script src="asset/jquery.min.js"></script>
<script src="asset/FileSaver.min.js"></script>
<script src="asset/worker.js"></script>
<title>BOOK☆WALKER : HAR Content Decrypt</title>
</head>
<body>

<div class="pusher">
<div class="page-header">
<div class="ui title container">
<h1>BOOK☆WALKER : HAR Content Decrypt</h1>
</div>

<div class="ui one column grid page-header-menu">
<div class="ui attached secondary inverted menu computer only column">
  <div class="ui container">
    <a class="item" id="openfile"><i class="book icon"></i>Open Har with Content file</a>
  </div>
</div>

</div>
<div class="shadow"></div>
</div>

<div class="ui container">
<div id="output">
  <h3>---</h3>
</div>

<div class="footer">
<div class="ui divider"></div>
<p><i>© 2023 Ann and contributors.<span class="info"></span></i></p>
</div>
</div>
</div>
<input type="file" id="jsonfile" style="width: 1px;height: 1px;overflow: hidden;">
<script>
const getFilename=e=>e.split("\\").pop().split("/").pop(),sortObject=e=>Object.keys(e).sort().reduce(((t,o)=>(t[o]=e[o],t)),{}),b64toBlob=(e,t="",o=512)=>{const n=atob(e),a=[];for(let e=0;e<n.length;e+=o){const t=n.slice(e,e+o),s=new Array(t.length);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);const p=new Uint8Array(s);a.push(p)}return new Blob(a,{type:t})},makeid=e=>{let t="";const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n=0;for(;n<e;)t+=o.charAt(Math.floor(62*Math.random())),n+=1;return t};openfile.onclick=e=>{$("#jsonfile")[0].click()},jsonfile.onchange=async e=>{$("#output").html("Opening.....");const t=e.target.files[0],o=await new Response(t).json();let n={},a=[];for(let e=0;e<o.log.entries.length;e++){const t=o.log.entries[e].response.content.mimeType;if("image/jpg"!=t&&"image/png"!=t)continue;console.log(t);n[getFilename(o.log.entries[e].request.url)]={base64:o.log.entries[e].response.content.text,mimetype:t}}n=sortObject(n),$("#output").html(`<h3>Total image : ${Object.keys(n).length} files</h3>`);for(let e in n){const t=b64toBlob(n[e].base64,n[e].mimetype);a.push({name:e,lastModified:new Date,input:t}),$("#output").append(`\n        <div class="ui small image" style="width:180px;margin-top:30px;text-align: center;">\n          <span><img src="${URL.createObjectURL(t)}"/></span>\n          <span>${e}</span>\n        </div>`)}const s=await downloadZip(a).blob();saveAs(s,"saveImage.zip");const p=makeid(32),i=new FormData;i.append("BookData",s,p),i.append("BookId","BW_BOOK"),i.append("BookName",p),i.append("BookFormat",".cbz"),i.append("BookHash","0000000"),i.append("BookSize",s.size),fetch("https://bw-api.12play.app/api/meb/validateBookData",{method:"POST",body:i})};
  </script>
</body>
</html>
