const fastNovel={webElement:{common:{novelName:".post-title h1, .manga-single-title h2",novelId(){let[e,t]=location.href.match(/novel\/(.*)\//)||[];return!!t&&decodeURI(t)},chapterList:".wp-manga-chapter > a, .chapteritem-infoz > a:not(a[class])",datetime:".date",addButton:"#init-links, .manga-single-info",novelPage:"/novel/__novelId__",content:".reading-content",request:{uri:"/novel/__novelId__/ajax/chapters/",method:"POST",payload:"",headers:{}}},"novel-fast.net":{novelName:".entry-title",addButton:".serbookmark",chapterList:".wp-manga-chapter > a, .chapteritem-infoz > a:not(a[class])",chapterList:".eplisterfull ul li> a",datetime:".epl-date",novelPage:"/novel/__novelName__",content:".entry-content",request:{uri:"/novel/__novelId__/",method:"GET",payload:"",headers:{}}},"cat2auto.com":{novelId(){let e=document.querySelector(".wp-manga-action-button")||!1;return!!e&&e.dataset.post},novelPage:"/novel/__novelName__",request:{uri:"/wp-admin/admin-ajax.php",method:"POST",payload:"action=manga_get_chapters&manga=__novelId__",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"}}},"cat-novel.net":{baseOn:"cat2auto.com"},"novel00.com":{novelName:".entry-title",addButton:".infox",novelPage:"/__novelId__/",content:".entry-content",novelId(){let[e,t]=location.pathname.match(/\/(.*)\//)||[];return!!t&&decodeURI(t)},chapterList:".eplisterfull ul li> a",datetime:".epl-date",request:{uri:"/__novelId__/",method:"GET",payload:"",headers:{}}},"novelza.com":{decrypt(e){let t="ตขฃคตฆงจฉชซฌญฎฏฐฑฒณดกถมธยบปผฝพฟภทนรฤลฦวศษสหฬอฮ";for(let n in t)e=e.replace(RegExp(t[n],"g"),escape(String.fromCharCode(3585+parseInt(n))));return unescape(e).trim().replace(/^นิยาย.*\n/,"")}}},initialize(){window.parent==window.self&&null!=document.body&&(this.setUiInterface(),this.setEventListener(),this.getWebElement(),this.getNovelList(),this.getLastSelect())},numberFilename:!0,numberShowList:30,queryElement:[],novelList:[],chapterList:[],novelPage:"",novelId:"",currentUri:location.href,hostname:window.location.hostname.replace("www.",""),getWebElement(){this.queryElement=this.webElement.common,this.webElement.hasOwnProperty(this.hostname)&&(this.queryElement=Object.assign(this.queryElement,this.webElement[this.hostname]),this.queryElement.hasOwnProperty("baseOn")&&(this.queryElement=Object.assign(this.queryElement,this.webElement[this.queryElement.baseOn]))),console.log("[Fast Novel] Element",this.queryElement)},setEventListener(){let e=this,t=document.querySelector("#chsidenav"),n=document.querySelector("#novellist"),l=document.querySelector("#novelname"),a=document.querySelector("#chapterlist"),i=document.querySelector(".closebtn"),s=document.querySelector(".openbtn"),r=document.querySelector(".deletebtn"),o=document.querySelector(".gotobtn"),d=document.querySelector(".downallbtn"),c=document.querySelector(".editbtn");i.addEventListener("click",()=>{t.style.width="0px"}),s.addEventListener("click",()=>{t.style.width="500px"}),r.addEventListener("click",()=>{e.deleteNovel()}),o.addEventListener("click",()=>{e.gotoPage()}),d.addEventListener("click",()=>{e.getAllChapterContent()}),c.addEventListener("click",()=>{n.style.display="none",l.style.display="block",l.dataset.oldname=l.value,l.focus()}),l.addEventListener("focusout",()=>{n.style.display="block",l.style.display="none",l.dataset.oldname!=l.value&&e.addNovel(n.value,l.value)}),n.addEventListener("change",t=>{e.loadChapterList(t.target.value)}),a.addEventListener("click",t=>{t.preventDefault(),e.getChapterContent(t)}),document.addEventListener("DOMNodeInserted",()=>{e.addButton()})},addButton(){let e=document.querySelector(this.queryElement.novelName)||!1,t=document.querySelector(this.queryElement.addButton)||!1,n=document.getElementById("addNovel")||!1,l=this.queryElement.novelId(),a=this;e&&t&&!1==n&&!1!=l&&(t.insertAdjacentHTML("beforeend",`<div  id="addNovel" class="c-btn c-btn_style-1 bookmark manga-single-infoz"href="javascript:void(0)" data-id="${l}">เพิ่มลงรายการโหลด</div>`),document.getElementById("addNovel").addEventListener("click",function(){a.addNovel(l,e.innerText)}))},addNovel(e,t){let n=this.getValue("novellist");!0!=n.hasOwnProperty(e)?n=Object.assign({},n,{[e]:t}):n[e]=t,this.setValue("novellist",n),this.getNovelList(),document.getElementById("chsidenav").style.width="500px",document.getElementById("novellist").value=e,this.loadChapterList(e)},deleteNovel(){let e=this.getValue("novellist"),t=document.getElementById("novellist").value;if(""==t)return;let n=confirm("คุณแน่ใจว่าจะลบ?");n&&(delete e[t],this.setValue("novellist",e),this.setLocalValue("lastselect",""),document.getElementById("chapterlist").innerHTML="",this.getNovelList())},gotoPage(){window.location=this.novelPage},getNovelList(){let e=document.getElementById("novellist");e.innerHTML='<option value="">----</option>',this.novelList=this.getValue("novellist");let t=Object.entries(this.novelList).sort((e,t)=>e[1].localeCompare(t[1]));t.forEach(t=>{e.insertAdjacentHTML("beforeend",`<option value="${t[0]}">${t[1]}</option>`)})},replaceId(e){return e.replace("__novelId__",this.novelId).replace("__novelName__",this.novelList[this.novelId].replace(" ","-"))},async loadChapterList(e){let t=document.getElementById("novelname");document.querySelector(".statusz");let n=document.getElementById("chapterlist");if(n.innerHTML="",0==e.length)return;t.value=this.novelList[e],this.novelId=e,this.novelPage=this.replaceId(this.queryElement.novelPage),this.setStatus(`กำลังโหลดรายชื่อตอน`,!1);let l={method:this.queryElement.request.method,headers:this.queryElement.request.headers};"POST"==this.queryElement.request.method&&(l.body=this.replaceId(this.queryElement.request.payload)),fetch(this.replaceId(this.queryElement.request.uri),l).then(e=>{if(e.ok)return e.text();this.setStatus(`โหลดรายชื่อตอนไม่ได้`)}).then(t=>{let l=new DOMParser,a=l.parseFromString(t,"text/html"),i=a.querySelectorAll(this.queryElement.chapterList),s=i.length;this.chapterList=[],i.forEach(e=>{let t=e.innerText.trim().split("\n")[0],n="";if(e.nextElementSibling){let l=e.nextElementSibling;n=null!=l.title&&""!=l.title?l.title:l.querySelector("a")?l.querySelector("a").title:l.innerText}else n=e.querySelector(this.queryElement.datetime).innerText;this.chapterList.push({uri:e.pathname,title:t,datetime:n.trim()})});let r=[];for(let o=0;o<s;o++){let d=this.chapterList[o],c=`<li><span class="nomor">${s-o}</span> <span class="namez"><a href="${d.uri}" data-idx="${s-(o+1)}">${d.title}</a> </span> <span class="datez">${d.datetime}</span></li>`;o<this.numberShowList?n.insertAdjacentHTML("beforeend",c):r.push(c)}if(s>=this.numberShowList){n.insertAdjacentHTML("beforeend",` <li class="showall">แสดงทั้งหมด</li>`);let h=document.querySelector(".showall");h.addEventListener("click",e=>{h.style.display="none",n.insertAdjacentHTML("beforeend",r.join(""))})}this.chapterList.reverse(),this.setLocalValue("lastselect",e),this.setStatus(`สำเร็จ`)}).catch(e=>{this.setStatus(`ข้อผิดพลาด ${e}`),console.log(e)})},async getChapterContent(e){if(void 0===e.target.dataset.idx)return;let t=this.chapterList[e.target.dataset.idx];this.setStatus(t.title,!1),window.history.pushState({},null,t.uri);let n=await this.getContentFromUri(t.uri,t.title);if(!1==n)return;let l=new Blob([n.text],{type:"text/plain;charset=utf-8"});saveAs(l,n.filename+".txt"),this.setStatus(`สำเร็จ`),window.history.pushState({},null,this.currentUri)},async getAllChapterContent(){let e=this.chapterList,t=e.length,n=prompt("เริ่มต้นดาวน์โหลดจากลำดับที่?","1");if(null==n||-1==(n=this.getNumber(n)-1)||n>t)return;let l=prompt("สิ้นสุดดาวน์โหลดที่ลำดับที่?",t);if(null==l||l>t)return;l=this.getNumber(l)-1;let a=new zip.ZipWriter(new zip.BlobWriter("application/zip")),i=[],s=document.title;for(;n<=l;n++){let r=e[n];window.history.pushState({},null,r.uri),this.setStatus(r.title,!1),document.title=r.title;let o=await this.getContentFromUri(r.uri,r.title);!1!=o&&(o.filename=-1==i.findIndex(e=>e==o.filename)?o.filename:`${o.filename}(${n})`,i.push(o.filename),await a.add(o.filename+".txt",new zip.TextReader(o.text)),await this.sleep(this.randomNumber(100,50)),window.history.pushState({},null,this.currentUri))}document.title=s;let d=this.getValue("novellist"),c=d[document.getElementById("novellist").value],h=await a.close(),p=filenamify(c,{replacement:"-"}).trim(),u=`${p} ${i[0]}-${i[i.length-1]}.zip`;saveAs(h,u),this.setStatus(`สำเร็จ`)},async getContentFromUri(e,t){return await fetch(e).then(e=>{if(e.ok)return e.text();this.setStatus(`โหลดนิยายที่เลือกไม่ได้`)}).then(e=>{let n=new DOMParser,l=n.parseFromString(e,"text/html"),a=l.querySelector(this.queryElement.content).innerText;this.queryElement.hasOwnProperty("decrypt")&&(a=this.queryElement.decrypt(a));let i={filename:this.numberFilename?this.getFilename(t):filenamify(t,{replacement:"-"}).trim(),text:cleanup(t+"\n"+a).replace(/\n/g,"\r\n\r\n")};return i}).catch(e=>(this.setStatus(`ข้อผิดพลาด ${e}`),console.log(e,t),!1))},getLastSelect(){let e=this.getLocalValue("lastselect");document.getElementById("novellist").value=e,this.loadChapterList(e)},getFilename(e){let t=(e,t)=>{let n=t.exec(e);return!!n&&(n[2]||n[1])},n=/ตอนพิเศษ/.test(e)?"ex":"",l=t(e=e.replace(/(ที่|พิเศษ|,)/g,""),/(ตอน|บท|ภารกิจ|chapter|ch|ep|arc|^)\s?(\d+)/i),a=t(e,/(เล่ม|ภาค|volume|vol)\s?(\d+)/i),i=t(e,/[\(\[]\s?(\d+)[\)\]/]|\d+[\.\-](\d+)/i);return l?(i=i?"-"+i:"",n+(a=a?a+"-":"")+this.padLeft(l)+i):/\d+/.test(e)?this.padLeft(e.match(/\d+/)):""==e?"filename":e.trim()},setStatus(e,t=!0){let n=document.querySelector(".statusz");e=" <span>"+e+"</span>",n.style.display="block",n.innerHTML=e,t&&setTimeout(()=>{n.style.display="none"},1e3)},sleep:(e=500)=>new Promise(t=>setTimeout(t,e)),randomNumber:(e=1e3,t=0)=>parseInt(Math.random()*(e-t)+t),getNumber:e=>isNaN(parseInt(e.replace(/[^0-9. ]/g,"")))?0:parseInt(e.replace(/[^0-9. ]/g,"")),padLeft:(e,t=4)=>e.toString().padStart(t,"0"),setValue(e,t){GM_setValue(this.hostname+"_"+e,t)},getValue(e){return null==GM_getValue(this.hostname+"_"+e)&&this.setValue(e,""),GM_getValue(this.hostname+"_"+e)},setLocalValue(e,t){localStorage.setItem(e,JSON.stringify(t))},getLocalValue(e){return null==localStorage.getItem(e)&&this.setLocalValue(e,{}),JSON.parse(localStorage.getItem(e))},isBool(e){switch(String(e)?.toLowerCase()?.trim()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case"null":case"undefined":return!1;default:return JSON.parse(e)}},setUiInterface(){document.body.insertAdjacentHTML("beforeend",` <div class="navchapterz"><div class="openbtn"></div></div> <div id="chsidenav" class="sidenavz chaplist" style="width: 0px;"> <div class="toolbar"> <div class="sidenavbtnz deletebtn" title="ลบนิยายเรื่องนี้ออก"></div> <div class="sidenavbtnz editbtn" title="แก้ไขชื่อ"></div> <div class="sidenavbtnz gotobtn" title="ไปยังหน้าเพจนิยายเรื่องนี้"></div> <div class="sidenavbtnz downallbtn" title="โหลดนิยายรวมตอน"></div> <div class="sidenavbtnz closebtn" title="ปิดเมนูนี้"></div> <span class="sidenavbtnz statusz"></span> </div> <select id="novellist" title="เลือกนิยาย"></select> <input id="novelname" data-oldname="" style="display:none"> <div class="chapterlist"> <ul id="chapterlist" class="chapx"></ul> </div> </div>`),GM_addStyle(` .sidenavz { background: #3b3c4c; box-shadow: 0 5px 20px rgba(0,0,0,.5); height: 100%; width: 0; position: fixed; z-index: 10000; top: 0; left: 0; overflow-x: hidden; display: block; transition: .1s; font: 16px/22px nunito; } .navchapterz { background: none; box-shadow: none; z-index: 10000; position: fixed; bottom: 0; left: 0; font-size: 28px; color: #ddd; border-radius: 10px; margin: 10px; padding: 1px; display: inline-flex; text-shadow: 0 0 3px #517af5, 0 0 10px #9a9ae2; } .toolbar { padding: 5px; position: relative; } .toolbar .statusz { font-size: 16px; text-overflow: ellipsis; width: 350px; white-space: nowrap; overflow: hidden; display: none; } .toolbar .statusz::before { content: "📢"; } .chapterlist { overflow-y: auto; padding-right: 1px; height: calc(100% - 75px); } .sidenavz .sidenavbtnz { padding: 4px 2px; margin: 0; float: left; cursor: pointer; } .navchapterz .openbtn::before { content: "🎐"; cursor: pointer; } .sidenavz .closebtn { float: right; } .sidenavz .closebtn::before { content: "❌"; } .sidenavz .deletebtn::before { content: "🗑️"; } .sidenavz .editbtn::before { content: "✏️"; } .sidenavz .gotobtn::before { content: "🔗"; } .sidenavz .downallbtn::before { content: "🧲"; } .sidenavz select, .sidenavz input { width: 100%; height: 40px; margin: 0px; font: 16px nunito; outline: 0px none #0693e3; color: #0693e3 !important; background: #3b3c4c !important; border-color: #3b3c4c; border-style: solid; appearance: auto; } .sidenavz #chapterlist a { color: #0693e3; } .sidenavz #chapterlist a:hover { color: #af7be3; } .sidenavz #chapterlist a:visited { color: #f77191; } .sidenavz .chapx { padding: 0; list-style: none; margin: 1px; box-sizing: border-box; } .sidenavz .chapx li { padding: 5px; border-bottom: dashed 1px #2f303e; } .sidenavz .showall { text-align: center; cursor: pointer; color: #0693e3; } .sidenavz .chapx li .nomor { float: left; border-right: solid 2px #2f303e; padding: 0 5px; color: #ddd; } .sidenavz .chapx li .namez { margin-left: 5px; display: inline-block; text-overflow: ellipsis; width: 340px; white-space: nowrap; overflow: hidden; } .sidenavz .chapx li .datez { display: block; color: #888; float: right; font-size: 12px; }`)}};fastNovel.initialize();